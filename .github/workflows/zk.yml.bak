name: Build and Upload Videos

on:
  # 触发条件：当推送带有vX.X.X格式的tag时执行
  push:
    tags:
      - 'v*'  # 匹配以v开头的tag，如v1.0.0

jobs:
  build-and-upload:
    runs-on: ubuntu-latest

    steps:
    # 1. 检出代码仓库
    - name: Checkout code
      uses: actions/checkout@v4

    # 2. 设置Python环境
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'  # 根据你的脚本需求修改版本号

    # 3. 安装依赖
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests bs4  # 确保你有requirements.txt文件

    # 4. 执行Python脚本生成视频
    - name: Run video generation script
      run: |
        python 6.py 

    # 5. 压缩res目录
    - name: Compress result folder
      run: |
        zip -r res.zip res/  # 递归压缩res目录

    # 6. 创建GitHub Release
    - name: Create Release
      id: create_release
      uses: github/release-action@v1
      with:
        tag: ${{ github.ref }}  # 使用触发工作的tag名称
        name: Release ${{ github.ref }}
        body: |
          Automated release of generated videos
        draft: false
        prerelease: false

    # 7. 上传压缩包到Release
    - name: Upload Release Asset
      uses: github/release-upload-action@v1
      with:
        release_id: ${{ steps.create_release.outputs.id }}
        asset_path: ./res.zip
        asset_name: generated_videos.zip
        asset_content_type: application/zip